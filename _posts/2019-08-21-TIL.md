---
layout: post
title:  "[TIL] 2019-08-21"
date:   2019-08-21 22:00:00
author: Seong-Kyu Yun
categories: [Today I Learned]













---

------

# Today I Learned (2019.08.21)







------

## ● JSP & Servlet



------

#### 1.  서블릿 메소드

------





------

##### 1-1. 서블릿 데이터 공유

------



------

##### 1) 객체별 공유 데이터 설정

------

<table border="1">
    <tr>
        <th>객 체</th>
        <th>사용 메소드</th>
        <th>내용</th>
    </tr>
    <tr>
        <th rowspan="4">ServletContext<br/>
            ServletRequest<br/>
            HttpSession</th>
        <td>setAttribute(String,Object)</td>
        <td>공유값을 저장</td>
    </tr>
    <tr>
        <td>getAttribute(String) </td>
        <td>공유값을 불러옴</td>
    </tr>
    <tr>
        <td>getAttributeName()</td>
        <td>공유값 전체를 불러옴</td>
    </tr>
    <tr>
        <td>removeAttribute(String)</td>
        <td>공유값 자체를 지움</td>
    </tr>
</table>

​      **&#42;&#42;공유값은 Map형식으로 저장됨. **



> 예제 - 이전에 만들어둔 프로젝트에 추가하여 만든다.

- **index에 다음을 추가**

```html

<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>파라미터확인하기</title>
</head>
<body>
	<h2>get방식으로 데이터 전송하기</h2>
	<fieldset>
		<legend>로그인</legend>
		<form action="loginGet.do" method="get">
			<label for="id">아이디</label>
			<input type="text" name="id" id="id"/>
			<br>
			<label for="pw">패스워드</label>
			<input type="password" name="pw" id="pw"/>
			<br>
			<input type="submit" value="로그인"/>
		</form>
	</fieldset>
	<h3>post로 데이터 전송</h3>
	<fieldset>
		<legend>로그인</legend>
		<form action="loginPost.do" method="post">
			아이디<input type="text" name="id" id="id"/>
			<br>
			비밀번호<input type="password" name="pw" id="pw"/>
			<br>
			<input type="submit" value="로그인"/>
		</form>
	</fieldset>


	<h2><a href="views/testPerson.html">
		1.개인취향테스트(basic)</a>
	</h2>
	<h2>
		<a href="views/testPerson1.html">
		2.개인취향테스트(requestDispatcher)</a>
	</h2>
	<h2>
		<a href="views/testPerson2.html">
		3.개인취향테스트(sendRedirect)</a>
	</h2>
	<h2>
		<a href="views/shareData.html">
		4.데이터확인</a>
	</h2>

</body>
</html>
```



- **views-shareData**

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>공유데이터 확인하기</title>
</head>
<body>
	<form action="/02_parameter/sharedata" method="post">
		context<input type="text" name="contextData"><br/>
		session<input type="text" name="sessionData"><br/>
		request<input type="text" name="requestData"><br/>
		<input type="submit" value="전송"/>
	</form>
</body>
</html>
```

- **controller-ShareDataServlet**

```java
package com.parameter.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Servlet implementation class ShareData
 */
@WebServlet("/sharedata")
public class ShareDataServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public ShareDataServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		//1. ServletContext객체 불러오기
		ServletContext context=request.getServletContext();
		//2. HttpSession객체 불러오기
		HttpSession session=request.getSession();
		//3. HttpServletRequest객체 불러오기
		context.setAttribute("context", request.getParameter("contextData"));
		session.setAttribute("session", request.getParameter("sessionData"));
		request.setAttribute("request", request.getParameter("requestData"));
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```

- **controller-ShareDataViewServlet**

```java
package com.parameter.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Servlet implementation class ShareDataViewServlet
 */
@WebServlet("/sendSharedata")
public class ShareDataViewServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public ShareDataViewServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		ServletContext context=request.getServletContext();
		HttpSession session=request.getSession();
		
		//객체에 데이터가 잘 들어갔는지 확인
		response.setContentType("text/html;charset=UTF-8");
		PrintWriter out = response.getWriter();
		out.print("<html>");
		out.print("<body>");
		out.print("<h3>context : " + context.getAttribute("context") + "</h3>");
		out.print("<h3>session : " + session.getAttribute("session") + "</h3>");
		out.print("<h3>request : " + request.getAttribute("request") + "</h3>");
		out.print("</body>");
		out.print("</html>");
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```

- **현 상태에서 출력결과**

```code
context : contextData
session : sessionData
request : requestData

// url : http://localhost:9090/02_parameter/sharedata
```

- **ShareDataServlet 에서 다음과 같이 변경 (sendRedirect 사용)**

```java
package com.parameter.controller;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.RequestDispatcher;
import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Servlet implementation class ShareData
 */
@WebServlet("/sharedata")
public class ShareDataServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public ShareDataServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		//1. ServletContext객체 불러오기
		ServletContext context=request.getServletContext();
		//2. HttpSession객체 불러오기
		HttpSession session=request.getSession();
		//3. HttpServletRequest객체 불러오기
		context.setAttribute("context", request.getParameter("contextData"));
		session.setAttribute("session", request.getParameter("sessionData"));
		request.setAttribute("request", request.getParameter("requestData"));
		
		//View로 데이터 전송!
//		RequestDispatcher rd=request.getRequestDispatcher("sendSharedata");
//		rd.forward(request, response);
		
		session.invalidate(); // 세션 객체 삭제!
		response.sendRedirect("sendSharedata");
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```

- **출력 결과**

```code
context : contextData
session : null  // session.invalidate();을 사용하지 않으면 정상 출력
request : null

// url : http://localhost:9090/02_parameter/sendSharedata
```



> **RequestDispatcher와 sendRedirect의 차이를 확인할 수 있다.**







------

#### 2.  Deployment Descriptor(DD) 설정

------





------

#### 2-1. 초기값 설정

------



---

##### 2-1-1. 서블릿 초기값 설정

----



------

##### 1) ServletConfig

---

> **web.xml에 대한 정보를 가져오는 객체(interface)로 저장할 객체를
> 만들어 저장하고 getServlet 메소드로 정보가 저장된 객체 호출가능, getInitParam(“저장이름”)으로 초기화된 값을 가져올 수 있음
> 　<small>&#42;&#42; 지정된 servlet에서만 활용 가능한 초기값임 / 동적 수정이 불가하여 상수값으로 보면 됨. </small>**
> 　**<small>&#42;&#42; servlet이 초기화된 이후에 활용가능</small>**



> 작성

```xml
<web-app>
	<servlet>
		<servlet-name>mappin명칭</servlet-name>
		<servlet-class>설정 클래스명칭</servlet-class>
		<init-param>
			<param-name>저장 이름</param-name>
			<param-value>저장값</param-value>
		</init-param>
	</servlet>
</web-app>
```







------

##### 2) ServletContext

------

> **ServletConfig의 초기값은 지정된 Servlet에서만 사용이 가능하나
ServletContext는 모든 어플리케이션이 공용으로 사용하는 초기값을
설정, 값은 getServletContext().getInitParam(“저장이름”)으로 호출
>   　<small>&#42;&#42;   `<servlet>`태그 안이 아니라 `<web-app>`내부에 설정 </small>**
>   　**<small>&#42;&#42; getServletContext앞에는 getConfig() / this가 생략되어 있음.</small>**
>   　**<small>&#42;&#42; server에 대한 각종정보도 가지고 있는 객체임 (api 참조) </small>**



> 작성

```xml
<web-app>
	<context-param>
		<param-name>저장 이름</param-name>
		<param-value>설정값</param-value>
	</context-param>
</web-app>
```





- **기존 작성 프로젝트의 WEB-INF/web.xml을 다음과 같이 수정한다.**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1">
  <display-name>02_parameter</display-name>
  <welcome-file-list>
    <welcome-file>index.html</welcome-file>
  </welcome-file-list>
  <context-param>
  	<param-name>admin</param-name>
  	<param-value>email@naver.com</param-value>
  </context-param>
</web-app>
```

- **controller-LikeServlet을 다음과 같이 수정한다.**

```java
package com.parameter.controller;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Enumeration;
import java.util.Iterator;
import java.util.Map;
import java.util.Set;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class LikeServlet
 */
@WebServlet("/like")
public class LikeServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public LikeServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		//client가 보낸 데이터 가져오기
		request.setCharacterEncoding("UTF-8");
		String name=request.getParameter("name");
		int age=Integer.parseInt(request.getParameter("age"));
		String color = request.getParameter("color");
		String[] foods = request.getParameterValues("food");
		System.out.println("name : " + name);
		System.out.println("age : " + age);
		System.out.println("color : " + color);
		System.out.print("foods : ");
		for(String food : foods) {
			System.out.print(food + " ");
		}System.out.println();
		
		//getParameterNames()
		//client가 보낸 key값들을 가져오는 메소드
		//보낸 input name 속성의 값들!
		//Enumeration 객체로 반환
		Enumeration e=request.getParameterNames();
		while(e.hasMoreElements()) {
			System.out.println("key"+request.getParameter((String)e.nextElement()));
		}
		
		//client가 보낸 값을 한 번에 Map 객체로 가져오기
		Map<String, String[]> map=request.getParameterMap();
		Set<Map.Entry<String,String[]>> set = map.entrySet();
		Iterator<Map.Entry<String,String[]>> it=set.iterator();
		while(it.hasNext()) {
			Map.Entry<String, String[]> c = it.next();
			for(String val:c.getValue()) {
				System.out.println(val);
			}
		};
		
		//응답페이지 구성해서 응답하기
		//view 페이지 선택
		ServletContext context=getServletContext();
		String adminEmail=context.getInitParameter("admin");
		
		
		response.setContentType("text/html;charset=UTF-8");
		PrintWriter out = response.getWriter();
		//out Stream에 html페이지 코드를 전송
		out.write("<html>");
		out.write("<body>");
		out.write("<h1>당신의 이름은 " +name+"입니다.</h1>");
		out.write("<h2>당신의 나이는 " +age+"살 입니다.</h2>");
		String choiceColor = "";
		switch(color) {
		case "빨강" : choiceColor="red";break;
		case "노랑" : choiceColor="yellow";break;
		case "파랑" : choiceColor="blue";break;
		case "초록" : choiceColor="green";break;
		case "보라" : choiceColor="purple";break;
		case "분홍" : choiceColor="pink";break;
		}
		out.write("<h4>당신이 좋아하는 색은 " + "<span style='color:"+choiceColor+";'>"+color+"</h4>");
		String src="";
		for(String f : foods) {
			switch(f) {
			case "보쌈": src="http://food.chosun.com/site/data/img_dir/2013/07/04/2013070401865_0.jpg";break;
			case "버섯전골": src="http://recipe1.ezmember.co.kr/cache/recipe/2018/02/24/674bd108c5ac44f3c2280ae2d09e1ca31.jpg"; break;
			case "햄버거": src="https://previews.123rf.com/images/cookelma/cookelma1502/cookelma150200141/36986768-%EB%A7%9B%EC%9E%88%EA%B3%A0-%EC%8B%9D%EC%9A%95%EC%9D%84-%EB%8F%8B%EC%9A%B0%EB%8A%94-%ED%96%84%EB%B2%84%EA%B1%B0-%EC%B9%98%EC%A6%88-%EB%B2%84%EA%B1%B0.jpg"; break;
			case "피자" : src="http://www.journal-d.kr/news/photo/201704/14768_9689_3049.jpg"; break;
			case "닭발" : src="http://www.yorivery.com/data/goods/1000000189_detail_022.jpg"; break;
			}
			out.write("<img src='"+src+"' width=200 height=200>");
		}
		out.write("<h4>관리자 : " + adminEmail + "</h4>");
		out.write("</body>");
		out.write("</html>");
		
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```

- **출력화면에 다음 내용이 추가된다.**

```code
관리자 : email@naver.com
```





'

'

------

#### 2-2. 리스너 설정

------



------

##### 2-2-1. 서블릿 리스너

------



------

##### 1) 서블릿 리스너란?

---

> 　**서블릿 리스너란, 웹 컨테이너가 관리하는 라이프 사이클 사이에 발생하는
> 이벤트를 감지하여 해당 이벤트가 발생 시 해당 이벤트에 대한 일련의
> 로직을 처리하는 인터페이스를 말한다.**



----

##### 2) 서블릿 이벤트 사용 용도

---

- **1. 웹 컨텍스트가 초기화되는 경우**

- **2. 세션이 생기거나 소멸되는 경우, session바인딩**

- **3. 요청 정보의 속성이 바뀌는 경우**

- **4. 속성값이 추가,삭제, 수정되는 경우(context, session, request)**



---

##### 3) 서블릿 리스너 동작 구조

----

![](C:\git\reviday.github.io\_posts\images\2019\서블릿 리스너 동작 구조.png)









------

##### 2-2-2. 서블릿 설정 및 클래스 작성

------



------

##### 1) DD설정(web.xml)

---

> 작성

```xml
<web-app>
	<listener>
		<listener-class>
			listener를 구현하고 있는 클래스(패키지명까지)
		</listener-class>
	</listener>
</web-app>
```







------

##### 2) 클래스 설정(java코드)

----

> 작성

```java
public class 클래스명 implements 구현할 리스너인터페이스
{
	해당하는 인터페이스 메소드 오버라이딩 처리
}
```



> 예제

```java
public class TestContext implements ServletContextListener
{
	@Override
	public void contextInitalized(ServletContextEvent event)
	{
		ServletContext sc=event.getServletContext();
		sc.setAttribute(“name”, ”자기이름”);
	}
}
```







------

##### 2-2-3. 서블릿 리스너(2)

------



---

##### 1) 서블릿 이벤트 리스너 종류

----

- **1. ServletContextListener / ServletContxtAttributeListener**
  - **웹 애플리케이션의 ServletContext 생성과 종료 시 발생**
  - **ServletContext에 속성이 추가, 제거, 수정시 발생**

- **2. HttpSessionListener / HttpSessionAttributeListener**
  - **동시에 접속시 발생, 접속중이 세션정보 확인**
  - **세션속성이 추가,제거, 수정시 발생**
- **3. HttpSessionBindingListener**
  - **HTTP 세션속성의 객체에 Binding되거나 해제되면 발생**
- **4. HttpSessionActivationListener**
  - **HTTP 세션이 활성화 또는 비활성화가 될때 발생**

- **5. ServletRequestListener / ServletRequestAttributeListener**
  - **요청이 발생하면 발생**
  - **HttpRequest객체에 속성이 추가, 제거, 수정되면 발생**







------

##### 2) ServletContextListener

----

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>ServletContext가 생성, 소멸되었을때 발생<br/>
            (어플리케이션 생성, 소멸시)</td>
    </tr>
    <tr>
        <th rowspan="2">매소드 종류</th>
        <td>contextInitialized(ServletContextEvent e) : void<br/>
            웹 컨테이너가 처음 구동되어<br/>
            ServletContext가 생성되었을때 작동하는 매소드</td>
    </tr>
    <tr>
        <td>contextDestoryed(ServletContextEvent e) : void<br/>
            웹 컨테이너가 종료될 때 실행되는 메소드<br/>
            ServletContext가 소멸 되었을 때 작동하는 매소드</td>
    </tr>
</table>

- **구조**

![](C:\git\reviday.github.io\_posts\images\2019\구조2.PNG)

- **index.html**

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>listener 확인</title>
</head>
<body>
	<a href="listener.do">리스너 확인</a>
</body>
</html>
```



- **web/WEB-INF/web.xml**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1">
  <display-name>03_listener</display-name>
  <welcome-file-list>
    <welcome-file>index.html</welcome-file>
    <welcome-file>index.htm</welcome-file>
  </welcome-file-list>
  <!-- 리스너등록 -->
  <listener>
  	<listener-class>
  		common.listener.ContextListener
  	</listener-class>
  </listener>
</web-app>
```



- **controller/ListenerTestServlet(생성만 한 상태)**

```java
package com.listener.controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class ListenerTestServlet
 */
@WebServlet("/listener.do")
public class ListenerTestServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public ListenerTestServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		response.getWriter().append("Served at: ").append(request.getContextPath());
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```



- **common.listener/ContextListener**

```java
package common.listener;

import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

public class ContextListener implements ServletContextListener {

	@Override
	public void contextDestroyed(ServletContextEvent arg0) {
		System.out.println("서버종료");
	}

	@Override
	public void contextInitialized(ServletContextEvent arg0) {
		System.out.println("서버시작");
		
	}

}
```



- **서버 실행시 콘솔창**

```code
8월 21, 2019 5:40:32 오후 org.apache.catalina.core.StandardEngine startInternal
정보: Starting Servlet Engine: Apache Tomcat/8.5.43
서버시작
8월 21, 2019 5:40:32 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["http-nio-9090"]
8월 21, 2019 5:40:32 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 5:40:32 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 322 ms
```



- **서버 종료시 콘솔창**

```html
정보: Pausing ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 5:41:21 오후 org.apache.catalina.core.StandardService stopInternal
정보: Stopping service [Catalina]
서버종료
8월 21, 2019 5:41:21 오후 org.apache.coyote.AbstractProtocol stop
정보: Stopping ProtocolHandler ["http-nio-9090"]
8월 21, 2019 5:41:21 오후 org.apache.coyote.AbstractProtocol stop
정보: Stopping ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 5:41:21 오후 org.apache.coyote.AbstractProtocol destroy
정보: Destroying ProtocolHandler ["http-nio-9090"]
8월 21, 2019 5:41:21 오후 org.apache.coyote.AbstractProtocol destroy
정보: Destroying ProtocolHandler ["ajp-nio-8009"]
```





------

##### 3) ServletContextAttributeListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>ServletContext 객체에 속성이 추가, 삭제, 수정될 때 발생</td>
    </tr>
    <tr>
        <th rowspan="3">매소드 종류</th>
        <td>attributeAdded(ServletContextAttributeEvent e) : void<br/>
새로운 속성 값이 추가될 때 실행되는 메소드</td>
    </tr>
    <tr>
        <td>attributeRemoved(ServletContextAttributeEvent e) : void<br/>
속성 값이 제거될 때 실행되는 메소드</td>
    </tr>
    <tr>
        <td>attributeReplaced(ServletContextAttributeEvent e) : void<br/>
속성 값이 변경될 때 실행되는 메소드</td>
    </tr>
</table>



- **ListenerTestServlet에 ServletContextAttributeListener 인터페이스 추가 및 메소드 오버라이드**

```java
package common.listener;

import javax.servlet.ServletContextAttributeEvent;
import javax.servlet.ServletContextAttributeListener;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContextListener;

public class ContextListener implements ServletContextListener,ServletContextAttributeListener {

	@Override
	public void contextDestroyed(ServletContextEvent arg0) {
		System.out.println("서버종료");
	}

	@Override
	public void contextInitialized(ServletContextEvent arg0) {
		System.out.println("서버시작");
		
	}

	@Override
	public void attributeAdded(ServletContextAttributeEvent arg0) {
		System.out.println("객체에 데이터 추가");
		
	}

	@Override
	public void attributeRemoved(ServletContextAttributeEvent arg0) {
		System.out.println("객체에 데이터 삭제");
	}

	@Override
	public void attributeReplaced(ServletContextAttributeEvent arg0) {
		// TODO Auto-generated method stub
		
	}

}
```



- **ListenerTestServlet의 doGet 메소드에 다음을 추가**

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		ServletContext context=request.getServletContext();
		context.setAttribute("name", "admin");
		context.removeAttribute("name");
}
```



- **ContextListener의 attributeAdded메소드에 다음을 추가**

```java
@Override
public void attributeAdded(ServletContextAttributeEvent event) {
		System.out.println("객체에 데이터 추가");
		System.out.println("추가된 key " + event.getName());
		System.out.println("추가된 value " + event.getValue());
}
```



- **다시 한 번 실행해보면 다음과 같이 콘솔창에 출력된다.**

```code
8월 21, 2019 5:45:35 오후 org.apache.catalina.core.StandardEngine startInternal
정보: Starting Servlet Engine: Apache Tomcat/8.5.43
서버시작
8월 21, 2019 5:45:35 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["http-nio-9090"]
8월 21, 2019 5:45:35 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 5:45:35 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 333 ms
객체에 데이터 추가
추가된 key name
추가된 value admin
객체에 데이터 삭제
```





------

##### 4) HttpSessionListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>HttpSession 객체가 생성되거나 소멸될 때 발생</td>
    </tr>
    <tr>
        <th rowspan="2">매소드 종류</th>
        <td>sessionCreated(HttpSession e) : void<br/>
세션이 생성되었을 경우 실행되는 메소드</td>
    </tr>
    <tr>
        <td>sessionDestoryed(HttpSession e) : void<br/>
세션이 무효화 되었을 경우 실행되는 메소드</td>
    </tr>
</table>





- **리스너를 다음과 같이 생성할 수 있다**

> **[common.listener] 에서 마우스 우클릭 -> [New] -> [Listener] 로 생성**

![](C:\git\reviday.github.io\_posts\images\2019\리스너생성.png)



- **리스너 클래스 이름 "SessionListener"를 입력(s 빼고)**

![](C:\git\reviday.github.io\_posts\images\2019\리스너생성2.png)



- **다음을 체크하고 생성**

![](C:\git\reviday.github.io\_posts\images\2019\리스너생성3.png)

- **SessionListener에 자동으로 HttpSessionListener가 implements되어 있고 메소드도 생성됨.
   그리고 다음을 추가!**

```java
package common.listener;

import javax.servlet.annotation.WebListener;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;

/**
 * Application Lifecycle Listener implementation class SessionListener
 *
 */
@WebListener
public class SessionListener implements HttpSessionListener {

    /**
     * Default constructor. 
     */
    public SessionListener() {
        // TODO Auto-generated constructor stub
    }

	/**
     * @see HttpSessionListener#sessionCreated(HttpSessionEvent)
     */
    public void sessionCreated(HttpSessionEvent arg0)  { 
         System.out.println("세션 생성!");
    }

	/**
     * @see HttpSessionListener#sessionDestroyed(HttpSessionEvent)
     */
    public void sessionDestroyed(HttpSessionEvent arg0)  { 
    	 System.out.println("세션 소멸!");
    }
	
}
```



- **이때, 실행해보면 콘솔창에서는**

```code
서버시작
8월 21, 2019 6:00:35 오후 org.apache.catalina.core.StandardContext reload
정보: Reloading Context with name [/03_listener] is completed
객체에 데이터 추가
추가된 key name
추가된 value admin
객체에 데이터 삭제
세션 생성!
```



- **ListenerTestServlet의 doGet메소드에 다음을 추가**

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		ServletContext context=request.getServletContext();
		context.setAttribute("name", "admin");
		context.removeAttribute("name");
		
		HttpSession session=request.getSession();
		response.setContentType("text/html;charset=UTF-8");
		PrintWriter out=response.getWriter();
		out.append("<button onclick='location.href=\"/03_listener/logout\"'>");
		out.append("로그아웃</button>");
}
```



- **controller에 LogoutServlet 서블렛 추가**

```java
package com.listener.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

/**
 * Servlet implementation class LogoutServlet
 */
@WebServlet("/logout")
public class LogoutServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public LogoutServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		HttpSession session=request.getSession();
		session.invalidate();
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```



- **이제 실행해보면**

![](C:\git\reviday.github.io\_posts\images\2019\화면.png)

- **클릭할 경우**

```code
객체에 데이터 추가
추가된 key name
추가된 value admin
객체에 데이터 삭제
세션 생성!
세션 소멸!
```



- **SessionListener를 다음과 같이 수정하면 세션의 갯수를 확인할 수 있다.**

```java
package common.listener;

import javax.servlet.annotation.WebListener;
import javax.servlet.http.HttpSessionEvent;
import javax.servlet.http.HttpSessionListener;

/**
 * Application Lifecycle Listener implementation class SessionListener
 *
 */
@WebListener
public class SessionListener implements HttpSessionListener {
	private static int count=0;
	
	public static int getCount() {
		return count;
	}
    /**
     * Default constructor. 
     */
    public SessionListener() {
        // TODO Auto-generated constructor stub
    }

	/**
     * @see HttpSessionListener#sessionCreated(HttpSessionEvent)
     */
    public void sessionCreated(HttpSessionEvent arg0)  { 
         System.out.println("세션 생성!");
         count++;
         System.out.println("현재 세션 갯수 : " + count);
    }

	/**
     * @see HttpSessionListener#sessionDestroyed(HttpSessionEvent)
     */
    public void sessionDestroyed(HttpSessionEvent arg0)  { 
    	 System.out.println("세션 소멸!");
    	 count--;
    }
	
}
```



- **콘솔 출력화면 **

```code
서버시작
8월 21, 2019 6:09:08 오후 org.apache.catalina.core.StandardContext reload
정보: Reloading Context with name [/03_listener] is completed
객체에 데이터 추가
추가된 key name
추가된 value admin
객체에 데이터 삭제
세션 생성!
현재 세션 갯수 : 1
세션 소멸!
```





------

##### 5) HttpSessionAttributeListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>HttpSession에 대한 속성 값이 변경될 경우 발생</td>
    </tr>
    <tr>
        <th rowspan="3">매소드 종류</th>
        <td>attributeAdded(HttpSessionBindingEvent e) : void<br/>
세션에 새로운 속성 값이 추가될 때 실행되는 메소드</td>
    </tr>
    <tr>
        <td>attributeRemoved(HttpSessionBindingEvent e) : void<br/>
세션에 속성 값이 제거될 때 실행되는 메소드</td>
    </tr>
    <tr>
        <td>attributeReplaced(HttpSessionBindingEvent e) : void<br/>
세션에 속성 값이 변경될 때 실행되는 메소드</td>
    </tr>
</table>







------

##### 6) HttpSessionActivationListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>HttpSession이 새로 생성되어 활성화 될 경우 발생</td>
    </tr>
    <tr>
        <th rowspan="2">매소드 종류</th>
        <td>sessionDidActivate(HttpSessionEvent e) : void<br/>
세션이 활성화 될 때 실행</td>
    </tr>
    <tr>
        <td>sessionWillPassivate(HttpSessionEvent e) : void<br/>
세션이 비활성화 되려고 할 때 실행</td>
    </tr>
</table>











------

##### 7) HttpSessionBindingListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>사용자의 현재 세션에 바인딩 되거나 해제될 객체가 발생할
경우 감지</td>
    </tr>
    <tr>
        <th rowspan="2">매소드 종류</th>
        <td>valueBound(HttpSessionBindingEvent e) : void<br/>
객체가 세션에 연결될 때 발생하는 이벤트를 실행</td>
    </tr>
    <tr>
        <td>valueUnBound(HttpSessionBindingEvnet e) : void<br/>
객체가 세션으로부터 연결이 해제될 때 발생하는 이벤트를
실행</td>
    </tr>
</table>









------

##### 8) ServletRequestListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>request객체가 생성, 소멸되었을때 발생</td>
    </tr>
    <tr>
        <th rowspan="2">매소드 종류</th>
        <td>requestInitialized(ServletRequestEvent e) : void<br/>
request객체가 생성되었을때 처리하는 메소드</td>
    </tr>
    <tr>
        <td>requestDestroyed(ServletRequestEvnet e) : void<br/>
request객체가 소멸 되었을때 처리하는 메소드</td>
    </tr>
</table>



- **같은 방법으로 RequestListener를 생성한다. [Servlet request events] - [Lifecycle]**

```java
package common.listener;

import javax.servlet.ServletRequestEvent;
import javax.servlet.ServletRequestListener;
import javax.servlet.annotation.WebListener;

/**
 * Application Lifecycle Listener implementation class RequestListener
 *
 */
@WebListener
public class RequestListener implements ServletRequestListener {

    /**
     * Default constructor. 
     */
    public RequestListener() {
        // TODO Auto-generated constructor stub
    }

	/**
     * @see ServletRequestListener#requestDestroyed(ServletRequestEvent)
     */
    public void requestDestroyed(ServletRequestEvent arg0)  { 
         System.out.println("요청종료");
    }

	/**
     * @see ServletRequestListener#requestInitialized(ServletRequestEvent)
     */
    public void requestInitialized(ServletRequestEvent arg0)  { 
         System.out.println("요청!!");
    }
	
}
```



- **같은 방식으로 실행할 경우, 콘솔 창**

```code
서버시작
8월 21, 2019 6:15:17 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["http-nio-9090"]
8월 21, 2019 6:15:17 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 6:15:17 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 348 ms
요청!!
객체에 데이터 추가
추가된 key name
추가된 value admin
객체에 데이터 삭제
세션 생성!
현재 세션 갯수 : 1
요청종료
요청!!
세션 소멸!
요청종료
```



- **RequestListener의 requestDestroyed메소드에 다음을 추가**

```java
public void requestDestroyed(ServletRequestEvent arg0)  { 
         System.out.println("요청종료");
         System.out.println(arg0.getServletRequest().getRemoteAddr());
}
```



- **다른 pc에서 접속 요청이 있을 경우 다음과 같이 출력된다.**

```code
요청!!
세션 소멸!
요청종료
192.168.20.30 
```



------

##### 9) ServletRequestAttributeListener

------

<table border="1">
    <tr>
        <th>발생 시점</th>
        <td>request객체에 속성이 추가, 제거, 수정됐을때 발생</td>
    </tr>
    <tr>
        <th rowspan="3">매소드 종류</th>
        <td>attributeAdded(ServletRequestEvent e) : void<br/>
객체에 속성이 추가됐을때 호출되는 매소드</td>
    </tr>
    <tr>
        <td>attributeReplaced(ServletRequestEvnet e) : void<br/>
객체의 속성이 수정되었을때 호출되는 매소드</td>
    </tr>
    <tr>
        <td>attributeRemoved(ServletRequestEvnet e) : void<br/>
객체에서 속성이 삭제 되었을때 호출되는 매소드</td>
    </tr>
</table>







------

#### 3.  서블릿 필터와 래퍼

------





------

##### 3-1. 서블릿 필터

------



------

##### 1) 서블릿 필터 동작 구조

---

![](C:\git\reviday.github.io\_posts\images\2019\서블릿 필터 동작 구조.png)





---

##### 2) 서블릿 필터 내부동작

----

![](C:\git\reviday.github.io\_posts\images\2019\서블릿 필터 내부동작.PNG)









------

##### 3) 서블릿 필터란?

---

> **javax.servlet.Filter 인터페이스를 상속 받아 구현하는 클래스. **
> **HTTP 요청과 응답 사이에서 전달되는 데이터를 가로채어 서비스에 맞게
> 변경하고 걸러내는 필터링 작업을 수행할 수 있는 클래스이다.**
> 　**<small>&#42;&#42;Servlet과 비슷한 모습을 보임 (init, destroy, doFilter)</small>**





----

##### 4) 처리내용

----

- **Request : 보안관련사항, 요청헤더와 바디 형식지정, 요청에 대한 log기록 유지**

- **Response : 응답 스트림압축, 응답스트림 내용 추가 및 수정, 새로운 응답 작성**
     <small> **&#42;&#42; 여러 가지 필터를 연결(chain / 서로 호출)하여 사용가능**</small>





------

##### 5) DD설정(web.xml)

----

> 작성(Filter등록)

```xml
<filter>
	<filter-name>필터설정이름</filter-name>
	<filter-class>필터를 구현한 클래스</filter-class>
	<init-param> // filter에서 사용할 값 설정
		<param-name>초기값설정이름</param-name>
		<param-value>설정값</param-value>
	</init-param>
</filter> 
```



> Filter-Mapping(url패턴과 매핑) **<span style="color:red">우선적용</span>**

```xml
<filter-mapping>
	<filter-name>등록된 필터이름</filter-name>
	<url-pattern>요청한 페이지 형식</url-pattern>
</filter-mapping> 
```



> 서블릿과 필터 맵핑(필터 적용 서블릿지정)

```xml
<filter-mapping>
	<filter-name>등록된 필터이름</filter-name>
	<servlet-name>적용할 서블릿명</servlet-name>
</filter-mapping>
```





------

##### 6) 클래스 설정(java코드)

---

```java
public class 클래스명 implements Filter
{
	@Override
	public void init(FilterConfig config) throws ServletException
	{ Filter호출시 작업 설정 }
	@Override
	public void doFilter(ServletRequest req, ServletResponse resp,
	FilterChain chain) throws ServletException,
	IOException
	{ 필터링 작업할 내용 }
	@Override
	public void destroy()
	{ 삭제시 작업 설정 }
}
```





- **구조**

![](C:\git\reviday.github.io\_posts\images\2019\구조3.PNG)



- **index.html**

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<form action="filter.do" method="post">
		제목 <input type="text" name="title"/><br/>
		내용 <textarea name="content" rows="3" cols="20"></textarea><br/>
		<input type="submit" value="등록">
	</form>
	<form action="addMember.do" method="post">
		이름 <input type="text" name="name"/><br/>
		나이 <input type="text" name="age"/><br/>
		주소 <input type="text" name="addr"/><br/>
		<input type="submit" value="회원가입">
	</form>
</body>
</html>
```



- **com.filter.controller/FilterTestServlet**

```java
package com.filter.controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class FilterTestServlet
 */
@WebServlet("/filter.do")
public class FilterTestServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public FilterTestServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		request.setCharacterEncoding("UTF-8");
		String title=request.getParameter("title");
		String content=request.getParameter("content");
		System.out.println("title : "+title);
		System.out.println("content : " +content);
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```



- **com.filter.controller/MemberEnrollServlet**

```java
package com.filter.controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class MemberEnrollServlet
 */
@WebServlet("/addMember.do")
public class MemberEnrollServlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public MemberEnrollServlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		String name=request.getParameter("name");
		String age=request.getParameter("age");
		String addr=request.getParameter("addr");
		
		System.out.println(name+", "+age+", "+addr);
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```



- **다음 화면과 같이 입력합니다.**

![](C:\git\reviday.github.io\_posts\images\2019\화면2.png)



- **한 번씩 테스트 해보면 다음과 같이 콘솔에 출력된다.**

```code
정보: Starting ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 7:38:22 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 439 ms
ì¼ì§ë§¤, 19, ê²½ê¸°ë ì±ë¨
title : 안녕하세요~
content : 안녕하세요! 프로그래밍 공부중입니다!
```



- **글자가 깨진다. setCharacterEncoding를 여러 번 설정해주기는 불편하다.
   그러므로 다음과 같이 진행한다. 일단 common.filter에 CharacterEncodingFilter를 생성한다.**

```java
package common.filter;

import java.io.IOException;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;

public class CharacterEncodingFilter implements Filter {

	@Override
	public void destroy() {
		// TODO Auto-generated method stub

	}

	@Override
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain)
			throws IOException, ServletException {
		request.setCharacterEncoding("UTF-8");
		response.setCharacterEncoding("UTF-8");
		
		chain.doFilter(request, response);
	}

	@Override
	public void init(FilterConfig filterConfig) throws ServletException {
		// TODO Auto-generated method stub

	}

}
```



- **filter를 적용하자. web.xml에 다음을 작성한다.**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://xmlns.jcp.org/xml/ns/javaee" xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" id="WebApp_ID" version="3.1">
  <display-name>04_filter</display-name>
  <welcome-file-list>
    <welcome-file>index.html</welcome-file>
  </welcome-file-list>
  <filter>
  	<filter-name>encoding</filter-name>
  	<filter-class>common.filter.CharacterEncodingFilter</filter-class>
  </filter>
  <filter-mapping>
  	<filter-name>encoding</filter-name>
  	<url-pattern>*.do</url-pattern> 
     <!--모든 .do 파일에 적용되게 된다.(/를 쓰지않아도 된다!) -->
  </filter-mapping>
</web-app>
```



- **이제 같은 방식으로 진행해보고 콘솔창을 확인해보자**

```code
8월 21, 2019 7:50:40 오후 org.apache.coyote.AbstractProtocol start
정보: Starting ProtocolHandler ["ajp-nio-8009"]
8월 21, 2019 7:50:40 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 412 ms
title : 안녕하세요~
content : 안녕하세요! 프로그래밍 공부중입니다!
일지매, 19, 경기도 성남

// 필터가 모두 적용되었음을 확인할 수 있다.
```



- **index에 다음을 추가하자**

```html
<form action="test.do" method="post">
		<input type="text" name="test">
		<select name="job">
			<option value="프로그래머">프로그래머</option>
			<option value="백수">백수</option>
			<option value="건물주님">건물주님</option>
			<option value="짜빠게띠요리사">짜빠게띠요리사</option>
		</select>
		<input type="submit" value="전송"/>
</form>
```



- **common.filter에 DataAddFilter 필터를 새로 생성한다.**

```java
package common.filter;

import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;

/**
 * Servlet Filter implementation class DataAddFilter
 */
@WebFilter("/test.do")
public class DataAddFilter implements Filter {

    /**
     * Default constructor. 
     */
    public DataAddFilter() {
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see Filter#destroy()
	 */
	public void destroy() {
		// TODO Auto-generated method stub
	}

	/**
	 * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain)
	 */
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		// TODO Auto-generated method stub
		// place your code here
		request.setAttribute("food", "삼겹살,보쌈,차돌");
		// pass the request along the filter chain
		chain.doFilter(request, response);
	}

	/**
	 * @see Filter#init(FilterConfig)
	 */
	public void init(FilterConfig fConfig) throws ServletException {
		// TODO Auto-generated method stub
	}

}
```



- **com.filter.controller에 FilterTest2Servlet 서블릿을 새로 만든다**

```java
package com.filter.controller;

import java.io.IOException;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

/**
 * Servlet implementation class FilterTest2Servlet
 */
@WebServlet("/test.do")
public class FilterTest2Servlet extends HttpServlet {
	private static final long serialVersionUID = 1L;
       
    /**
     * @see HttpServlet#HttpServlet()
     */
    public FilterTest2Servlet() {
        super();
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see HttpServlet#doGet(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		String test=request.getParameter("test");
		String job=request.getParameter("job");
		String food=(String)request.getAttribute("food");
		System.out.println(test+" : " +job);
		System.out.println("food : " +food);
	}

	/**
	 * @see HttpServlet#doPost(HttpServletRequest request, HttpServletResponse response)
	 */
	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
```



- **FilterTestServlet에도 doGet 메소드에 다음 코드를 추가한다.**

```java
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		String title=request.getParameter("title");
		String content=request.getParameter("content");
		String food=(String)request.getAttribute("food");
		System.out.println("title : "+title);
		System.out.println("content : " +content);
		System.out.println("food : " +food);
	}
```



- **추가한 폼에 데이터를 입력해서 사용해보자. 콘솔창에는?**

```code
8월 21, 2019 8:16:36 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 344 ms
ㅁㄴㅇㄴㅁ : 건물주님
food : 삼겹살,보쌈,차돌

// 2개 이상의 필터를 적용 시킬 수 있음을 알 수 있다.
```





------

##### 7) @(annotation)적용 설정

------

> **<span style="color:blue">@WebFilter</span>를 활용하여 annotation으로 필터를 설정할 수 있다.**
> 　**<small>&#42;&#42;필터를 구현한 클래스에 선언하면 된다.</small>**



------

##### 8) 설정방법

----

<table border="1" >
    <tr style="text-align: center">
        <th >구 분</th>
    </tr>
    <tr>
        <td>@WebFilter(“요청url”)
        </td>
    </tr>
    <tr>
        <td>@WebFilter(value=“요청url”)</td>
    </tr>
    <tr>
        <td>@WebFilter(urlPatterns=“패턴”)</td>
    </tr>
    <tr>
        <td>@WebFilter(servletNames=“서블릿이름”)</td>
    </tr>
    <tr>
        <td>@WebFilter(servletnames={“서블릿1”, “서블릿2”})</td>
    </tr>
    <tr>
        <td>@WebFilter(<br/>
            		urlPatterns=“url패턴”,<br/>
            		initParams=@webInitParam(name=“이름”, value=“값”)<br/>
           	 )</td>
    </tr>
</table>



------

##### 9) Filter Interface

---

- **init(FilterConfig config);**

> 웹 컨테이너가 필터를 호출할 경우 해당 메소드가 호출되어
> 필터 객체를 생성하며 초기화한다.
>  ** 매개변수 FilterConfig는 web.xml에 있는 정보를 가지고 있음. 



- **doFilter(ServletRequest req, ServletResponse res, FilterChain chain)**

> 필터가 수행될 때 구동하는 메소드로, 요청 객체와 응답 객체를 사용해
> 일련의 작업을 수행한 뒤, chain을 통해 가공된 값을 목적지로 전송한다.



- **destroy();**

> 역할이 끝난 필터는 웹 컨테이너에 의해 해당 메소드를 호출하고
> 소멸된다.





------

##### 10) FilterChain (interface)

---

> **필터는 chain처럼 서로 연결되어 있는데 연결 되어있는 필터를
> 순차별로 doFilter() 매소드를 이용하여 실행시키는 인터페이스, 마지막
> 필터가 실행된 후에는 service() 매소드를 실행시켜 서블릿의 매소드
> (doGet(), doPost())를 실행**



- **doFilter(ServletRequest req, ServletResponse)**

> chain으로 연결되어있는 다음 필터를 실행하는 매소드



------

##### 11) dispatcher처리

----

> **2.4버전부터 dispatcher의 요청도 필터를 적용할 수 있음.**



> Filter-Mapping(url패턴과 매핑)

```xml
<filter-mapping>
	<filter-name>등록된 필터이름</filter-name>
	<url-pattern>요청한 페이지 형식</url-pattern>
<dispatcher>
	REQUEST || INCLUDE || FORWARD || ERROR
</dispatcher>
</filter-mapping>
```







- **다음으로, 만들어 놓은 서블릿에 @WebServlet 어노테이션을 다음과 같이 이름을 부여한다.**

```java
@WebServlet(name="filterTest", urlPatterns="/filter.do")
public class FilterTestServlet extends HttpServlet {
    ....
}
```

```java
@WebServlet(name="filter2Test",urlPatterns="/test.do")
public class FilterTest2Servlet extends HttpServlet {
    ....
}
```

```java
@WebServlet(name="memberenroll",urlPatterns="/addMember.do")
public class MemberEnrollServlet extends HttpServlet {
    ....
}
```



- **DataAddFilter의 @WebFilter 어노테이션을 다음과 같이 바꿔준다.**

```java
@WebFilter(servletNames= {
			"filterTest",
			"filter2Test"
		})
public class DataAddFilter implements Filter {
    ....
}
```



- **콘솔창에 똑같이 출력됨을 확인할 수 있다.**

````code
8월 21, 2019 8:24:03 오후 org.apache.catalina.startup.Catalina start
정보: Server startup in 330 ms
ㅁㄴㅇㄴㅁ : 프로그래머
food : 삼겹살,보쌈,차돌
````











------

##### 3-2. 서블릿 래퍼

------



------

##### 1) 서블릿 래퍼란?

----

> **관련 클래스(ServletRequest, ServletResponse, HttpServletRequest, HttpServletResponse)를 내부에 보관하며, 내부에 있는 클래스가 구현하고 있는 매소드로 위임(구현이 되어있다는 의미)하여 모든 매소드가 구현된 상태이기 때문에 필요한 매소드만 구현하면 됨. **
> 　**<small>&#42;&#42;즉, java Event처리의 Adapter클래스와 비슷한 기능</small>**





------

##### 2) 서블릿 래퍼 종류

---

<table border="1">
    <tr>
        <th>클래스명</th>
        <th>내 용</th>
    </tr>
    <tr>
        <td>ServletRequestWrapper</td>
        <td>ServletRequest객체를 구현한 객체를 가지고 있음</td>
    </tr>
    <tr>
        <td>ServletResponseWrapper</td>
        <td>ServletResponse객체를 구현한 객체를 가지고 있음</td>
    </tr>
    <tr>
        <td>HttpServletRequestWrapper</td>
        <td>HttpServletRequest객체를 구현한 객체를 가지고 있음</td>
    </tr>
    <tr>
        <td>HttpServletResponseWrapper</td>
        <td>HttpServletResponse객체를 구현한 객체를 가지고 있음</td>
    </tr>
</table>





------

##### 3) 서블릿 래퍼 내부동작

---

![](C:\git\reviday.github.io\_posts\images\2019\서블릿 래퍼 내부동작.PNG)





------

##### 4) Wrapper클래스를 상속한 클래스 생성

----

> 작성

```java
class 클래스명 extends Wrapper클래스명
{
	생성자(HttpServletRequest / response 매개변수명)
	{ super(매개변수명); }
	@Override
	// 원하는 매소드 오버라이딩 처리
	ex) public String getParameter(String name)
	{
		if(super.getParameter(name).equals(“kim”) return “김”;
		else return “김이 아닙니다“;
	}
}
```





- **common.filter에 MyWrapper를 만들어준다.**

```java
package common.filter;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletRequestWrapper;

public class MyWrapper extends HttpServletRequestWrapper {

	public MyWrapper(HttpServletRequest request) {
		super(request);
		// TODO Auto-generated constructor stub
	}
	
    // 많이 사용되는 getParameter로 테스트해보자!
	@Override
	public String getParameter(String name) {
		// TODO Auto-generated method stub
		String temp=super.getParameter(name);
		temp+="지매";
		return temp;
	}

	
}
```



- **common.filter에 WrapperTestFilter를 하나 더 만든다.**

```java
package common.filter;

import java.io.IOException;
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.annotation.WebFilter;
import javax.servlet.http.HttpServletRequest;

/**
 * Servlet Filter implementation class WrapperTestFilter
 */
@WebFilter("*.do")
public class WrapperTestFilter implements Filter {

    /**
     * Default constructor. 
     */
    public WrapperTestFilter() {
        // TODO Auto-generated constructor stub
    }

	/**
	 * @see Filter#destroy()
	 */
	public void destroy() {
		// TODO Auto-generated method stub
	}

	/**
	 * @see Filter#doFilter(ServletRequest, ServletResponse, FilterChain)
	 */
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		// TODO Auto-generated method stub
		// place your code here
		MyWrapper my=new MyWrapper((HttpServletRequest)request);
		// pass the request along the filter chain
		chain.doFilter(my, response);
	}

	/**
	 * @see Filter#init(FilterConfig)
	 */
	public void init(FilterConfig fConfig) throws ServletException {
		// TODO Auto-generated method stub
	}

}
```



- **이제 한 번 만들어 보자.(2번째로 해보았다.) 콘솔창은 다음과 같이 출력된다.**

```code
일지매지매, 19지매, 경기도 성남지매

//모든 파라미터에 '지매'가 붙어서 출력된다.
```



- **이제 이 방법을 응용해보자. MyWrapper로 돌아간다.
    다음과 같이 작성해보자. **

```java
@Override
	public String getParameter(String name) {
		// TODO Auto-generated method stub
		if(name.equals("name")) {
			return super.getParameter(name)+"님 환영합니다.";
		} else if(name.equals("age")) {
			return String.valueOf(Integer.parseInt(super.getParameter(name))+100);
		} else {
			String temp=super.getParameter(name);
			temp+="지매";
			return temp;
		}
	}
```



- **한 번 더 똑같이 실행!**

```code
일지매님 환영합니다., 119, 경기도 성남지매

// 파라미터 값에 따라 다르게 적용되는 것을 확인할 수 있다.
```

